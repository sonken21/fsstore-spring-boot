<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết đơn hàng #FS-[[${order.id}]]</title>
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .order-container { max-width: 900px; margin: 40px auto; }
        .order-card { border: none; border-radius: 15px; overflow: hidden; }
        .bg-gradient-primary { background: linear-gradient(135deg, #4e73df 0%, #224abe 100%); color: white; }
        .product-img { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; }
        .status-badge { border-radius: 50px; padding: 5px 15px; font-size: 0.8rem; }
    </style>
</head>
<body class="bg-light">
<div class="container order-container">
    <div class="mb-4">
        <a href="/account" class="btn btn-link text-decoration-none text-muted">
            <i class="fas fa-chevron-left mr-1"></i> Quay lại tài khoản
        </a>
    </div>

    <div class="card order-card shadow-sm">
        <div class="card-header bg-gradient-primary p-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-0 font-weight-bold">Đơn hàng #FS-[[${order.id}]]</h4>
                    <span class="small opacity-75" th:text="'Ngày đặt: ' + ${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}"></span>
                </div>
                <span class="badge badge-light status-badge text-primary font-weight-bold" th:text="${order.status}">STATUS</span>
            </div>
        </div>

        <div class="card-body p-4">
            <div class="row mb-4">
                <div class="col-md-6 border-right">
                    <h6 class="text-uppercase text-muted small font-weight-bold mb-3">Thông tin người nhận</h6>
                    <p class="mb-1"><strong th:text="${order.firstName + ' ' + order.lastName}"></strong></p>
                    <p class="mb-1 text-muted small"><i class="fas fa-phone mr-2"></i>[[${order.phone}]]</p>
                    <p class="mb-1 text-muted small"><i class="fas fa-envelope mr-2"></i>[[${order.email}]]</p>
                </div>
                <div class="col-md-6">
                    <h6 class="text-uppercase text-muted small font-weight-bold mb-3">Địa chỉ giao hàng</h6>
                    <p class="mb-1 text-muted small">[[${order.streetAddress}]]</p>
                    <p class="mb-1 text-muted small">[[${order.city}]]</p>
                    <p class="mb-0 text-muted small">PTTT: <span class="badge badge-secondary" th:text="${order.paymentMethod}"></span></p>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table">
                    <thead class="bg-light">
                    <tr class="small text-muted">
                        <th>Sản phẩm</th>
                        <th class="text-center">Số lượng</th>
                        <th class="text-right">Giá</th>
                        <th class="text-right">Thành tiền</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="detail : ${orderDetails}">
                        <td class="align-middle">
                            <div class="d-flex align-items-center">
                                <img th:src="@{'/assets/images/demoes/demo6/products/' + ${detail.product.imageUrl}}"
                                     class="product-img mr-3 shadow-sm"
                                     alt="Product Image"
                                     onerror="this.src='/assets/img/noproduct.png';"> <div>
                                <span class="font-weight-bold text-dark d-block" th:text="${detail.product.name}">Tên sản phẩm</span>
                                <small class="text-muted" th:text="'Mã SP: #' + ${detail.product.id}"></small>
                            </div>
                            </div>
                        </td>
                        <td class="text-center align-middle" th:text="${detail.quantity}">0</td>
                        <td class="text-right align-middle" th:text="${#numbers.formatDecimal(detail.price, 0, 'COMMA', 0, 'POINT') + ' ₫'}">0 ₫</td>
                        <td class="text-right align-middle font-weight-bold text-primary"
                            th:text="${#numbers.formatDecimal(detail.subTotal, 0, 'COMMA', 0, 'POINT') + ' ₫'}">0 ₫</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="row justify-content-end mt-3">
                <div class="col-md-5">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between border-0 px-0">
                            <span class="text-muted">Tổng tiền hàng:</span>
                            <span th:text="${#numbers.formatDecimal(order.subTotal, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between border-0 px-0">
                            <span class="text-muted">Phí vận chuyển:</span>
                            <span th:text="${#numbers.formatDecimal(order.shippingFee, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <h5 class="font-weight-bold">Tổng cộng:</h5>
                            <h5 class="text-danger font-weight-bold" th:text="${#numbers.formatDecimal(order.orderTotal, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></h5>
                        </li>
                    </ul>
                    <div class="mt-3 text-right" th:if="${order.status == 'PENDING'}">
                        <form th:action="@{'/account/order/cancel/' + ${order.id}}" method="post"
                              onsubmit="return confirm('Bạn có chắc chắn muốn hủy đơn hàng này không?');">
                            <button type="submit" class="btn btn-outline-danger btn-sm px-4 shadow-sm">
                                <i class="fas fa-trash-alt mr-1"></i> Hủy đơn hàng
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div th:if="${order.orderNotes != null}" class="mt-4 p-3 bg-light rounded border-left border-primary">
                <small class="text-muted d-block mb-1 font-weight-bold">Ghi chú đơn hàng:</small>
                <span class="small italic" th:text="${order.orderNotes}"></span>
            </div>
        </div>
    </div>
</div>
</body>
</html>